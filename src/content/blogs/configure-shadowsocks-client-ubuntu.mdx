---
title: "Configure shadowsocks client on ubuntu"
description: "Shadowsocks is great tool, windows and android clients are close to wireguard in its capabilities to wrap all traffic. On ubuntu it is not so straightforward."
datetime: "2024-09-04"
image: "/ss_sst_u.png"
url: "/blog/configure-shadowsocks-client-ubuntu"
---

# Configure shadowsocks client on ubuntu
Shadowsocks is popular option for building secure tunnels with masked traffic, it simple and ligthweigth. Unlike other similar tools like wireguard or openvpn it have lack of organized development process. So there is no good centralised documentation, multiple versions and tricky client configuration.

## Server
Server setup is simple-dimple, below is sample docker compose, you have to install docker to use it.
```yaml
version: "2.1"
services:
  shadowsocks:
    image: shadowsocks/shadowsocks-libev:v3.3.5
    container_name: shadowsocks
    ports:
      - 8388:8388
      - 8388:8388/udp
    environment:
      - METHOD=chacha20-ietf-poly1305
      - PASSWORD=your_password
    restart: always
```
## Client
Client is working as local proxy, that means you configure and connect it to your remote server, locally it is exposed as http or socks5 proxy. 
- For **Windows** there is nice gui client, you can set global proxy with single click i was able to use almost same as wiregurd client. However there is some applications that are ignoring system proxy configuration, so their tfaffic will pass by the tunnel.
- **Android** client is also have quite smooth use experience one client and all traffic is wrapped.
- There is a plenty of clients for **Ubuntu** but did not found a proper that can work like wireguard, you have to configure each app individually in some cases it is impossible.
- I did not checked **macOS** and **iOS** yet =)

## Configuring shadowsocks to wrap all traffic on Ubuntu
Proper solution for Ubuntu is use shadowsocks in combinations with tool like tun2socks, this tools stream your traffic from network adaptor to shadowsocks loclal proxy. Lets try to configure such conbintaion.
Lets install following tools:
- tun2socks https://github.com/xjasonlyu/tun2socks
- shadowsocks https://github.com/shadowsocks/shadowsocks-rust 
I downloalded binariws from release pages and moved binaries to ``/usr/bin``

Assyming you have server running as configured above, we will use `sslocal` binary, so your client command will be 
```bash
sslocal -s "shadowsocks_server:shadowsocks_port" -k "your_password" -m "chacha20-ietf-poly1305" --local-addr 127.0.0.1:1080 -U
```
Output should look like mine:

![Shadowsocks Output](../../assets/2024-10-24_12-06.png)  

Now you can test client with curl `curl --proxy "127.0.0.1:1080" "https://ifconfig.me"` it should return ip adress of your remote shadowsocks server. Now you need to create local network adapter and route all traffict to it then your have to start tun2socks to direct traffict from that adapter to shadowsocks tunnel.
Lets create network adapter:
```bash
ip tuntap add mode tun tun0
ip addr add 10.0.0.2/24 dev tun0
ip link set dev tun0 up
```
Lets run tun2socks `tun2socks -device tun0 -proxy socks5://127.0.0.1:1080`, lets check if it works ` curl --interface tun0 http://ifconfig.me`, output should be your shadowsocks server ip.

Proper tun2socks output look like that

![Tun2socks Output](../../assets/2024-10-24_12-29.png)  

Now lets direct your traffic to network interface **tun0** and exclude traffict that goes to shadowsocks server, othevice it will stuck in loop.
You need to obtain your gateway adress and outer interface name:
```bash 
# gateway ip adress
ip route | grep default | awk '{print $3}'
# outer inteface
ip route | grep default | awk '{print $5}'
```
Configure traffic routing:
```bash
ip route add "shadowsocks_server_ip" via "gateway_ip" dev "outer_interface"
ip rule add to "shadowsocks_server_ip" lookup main priority 1000
```
Last command may cause issues if something is not working you may endup without internet at all so your here is command and command to undo it:
- to route traffic to tunnel `ip route add default dev tun0 table 100`
- to rever it `ip route delete default dev tun0 table 100`
If all works fine you can open browser and go to https://www.iplocation.net it should show location of your server, you can test with curl aswell `curl "https://ifconfig.me`.












